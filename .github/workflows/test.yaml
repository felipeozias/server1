name: Testes
run-name: Realizando testes ğŸ‘â€ğŸ—¨ğŸ‘â€ğŸ—¨

on:
  workflow_run:
    workflows: [Build]
    types:
      - completed

jobs:
  teste:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Checkout cÃ³digo-fonte
        uses: actions/checkout@v3

      - name: Instalando dependÃªncias
        run: yarn

      - name: Testanto aplicaÃ§Ã£o com Jest
        run: yarn test && echo 'ğŸŸ¢ğŸŸ¢ğŸŸ¢ OS TESTES PASSARAM ğŸš€'

  deploy-staging:
    runs-on: ubuntu-latest
    needs: [teste]
    if: github.ref_name == 'main'

    steps:
      - name: deploy
        uses: fjogeleit/http-request-action@v1
        with:
          url: "${{ secrets.STAGIN_DEPLOY_KEY }}"
          # url: "https://api.render.com/deploy/${{ secrets.STAGIN_KEY }}&ref=${{ github.sha }}"
